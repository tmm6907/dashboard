{
	auto_https off
}

# Serve Astro frontend
mashboard.app {
	@cors_options method OPTIONS
	handle @cors_options {
		respond "" 204
	}

	# Proxy API requests to backend
	handle /api/* {
		reverse_proxy server:8080
		header Access-Control-Allow-Origin *
		header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
		header Access-Control-Allow-Headers "Content-Type, Authorization"
	}

	# Proxy all other requests to SSR frontend running on port 3030
	handle /* {
		reverse_proxy server:3030
	}
}

mail.localhost.com {
	tls internal

	@smtp {
		protocol smtp
	}

	handle @smtp {
		reverse_proxy mail:25
	}
}

:25 {
	handle {
		reverse_proxy mail:25
	}
}
